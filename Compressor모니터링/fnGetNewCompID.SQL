
DELIMITER //
Create Function getNewCompID() RETURNS VARCHAR(10)
BEGIN
-- 새로운 장비 정보 생성을 위해 COMP_ID 부여.
-- 년/월/Count

DECLARE V_RETVAL VARCHAR(10) DEFAULT '';
DECLARE V_CNT INT DEFAULT 0;
DECLARE V_COND VARCHAR(10);
DECLARE V_DAYSTR VARCHAR(10) DEFAULT '';

	-- 조회 조건 생성
	SELECT DATE_FORMAT(NOW(),'%Y%m') INTO V_DAYSTR FROM DUAL;	 
	SELECT CONCAT( V_DAYSTR , '%') INTO V_COND FROM DUAL;
	-- 조건의 데이터 건수
	SELECT COUNT(*) + 1 INTO V_CNT FROM TBM_COMPRESSOR WHERE COMP_ID LIKE V_COND;
	-- 리턴 값
	SELECT CONCAT( V_DAYSTR , LPAD(CONCAT(V_CNT),4,'0')) INTO V_RETVAL FROM DUAL;

RETURN V_RETVAL;

END
//

DELIMITER ;
