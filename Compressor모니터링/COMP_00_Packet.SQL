

DELIMITER $$
Create Procedure COMP_00_Packet(
	IN V_COMP_ID VARCHAR(20),
	IN V_MOBILE_PHONE_NO VARCHAR(20),
	OUT V_RESULT INT
)
Begin
/*
@description
-- 0번 패킷을 받아서, COMP정보에 조회하고
-- 해당 정보가 있다면, 승인 처리하고 인증 시간을 업데이트 한다.
@param
@return : 정보가 있다면 1, 없다면 0
*/
DECLARE cnt INT;

DECLARE exit handler for SQLEXCEPTION
BEGIN
	ROLLBACK;
	SET V_RESULT = -1;
END;

SELECT 
	Count(*) INTO cnt
FROM TBM_COMPRESSOR
WHERE COMP_ID = V_COMP_ID
AND MOBILE_PHONE_NO = V_MOBILE_PHONE_NO;

-- 해당하는 값이 없다면 RETURN
IF cnt < 1 THEN
	SET V_RESULT = 0;
	RETURN;
ELSE
	UPDATE TBM_COMPRESSOR
		SET REGIST_YN = 'Y', REGIST_TIME = DATE_FORMAT(NOW(),'%Y%m%d%h%i%s')
		WHERE COMP_ID = V_COMP_ID AND MOBILE_PHONE_NO = V_MOBILE_PHONE_NO;
	
	INSERT TBP_COMPRESSOR()
	SELECT * FROM TBM_COMPRESSOR
	WHERE COMP_ID = V_COMP_ID AND MOBILE_PHONE_NO = V_MOBILE_PHONE_NO;

	SET V_RESULT = 1;
END IF;

COMMIT;
END$$

DELIMITER;
